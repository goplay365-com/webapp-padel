// ...existing code...
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>GOPLAY 365 - Padel Mate</title>
    <style>
        /* ...existing styles... */
        body { background-color:#0d0d0d; color:#fff; font-family:'Segoe UI',sans-serif; display:flex; flex-direction:column; align-items:center; padding:20px;}
        .container{ max-width:400px; width:100%;}
        h1{ color:#39FF14; text-transform:uppercase;}
        .card{ background:#1a1a1a; padding:20px; border-radius:15px; border:1px solid #39FF14; box-shadow:0 0 10px #39ff1455;}
        input,select,button{ width:100%; padding:12px; margin:10px 0; border-radius:5px; border:none;}
        input,select{ background:#333; color:white; border:1px solid #444;}
        button{ background-color:#39FF14; color:black; font-weight:bold; cursor:pointer; text-transform:uppercase;}
        .compliance-text{ font-size:0.8rem; color:#888; margin-top:10px;}
        .checkbox-group{ display:flex; align-items:flex-start; gap:10px;}
        .checkbox-group input{ width:auto; margin-top:4px;}
        .busy { opacity:0.7; pointer-events:none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>GOPLAY 365</h1>
        <div class="card">
            <h3>Find a Padel Teammate</h3>
            <form id="lead-form">
                <select id="level" required>
                    <option value="" disabled selected>Your Level</option>
                    <option value="beginner">Beginner</option>
                    <option value="intermediate">Intermediate</option>
                    <option value="pro">Pro</option>
                </select>
                <input type="text" id="name" placeholder="Your Name" required>
                <input type="email" id="email" placeholder="Email Address" required>
                <input type="tel" id="phone" placeholder="Phone Number" required>
                <div class="checkbox-group">
                    <input type="checkbox" id="consent" required>
                    <label for="consent" class="compliance-text">
                        I agree to the Terms and join the Brand Club to receive rewards, sports news, and commercial offers.
                    </label>
                </div>
                <button id="submit-btn" type="submit">Find My Match</button>
            </form>
            <div id="msg" style="color:#39FF14; display:none; margin-top:8px;"></div>
        </div>
    </div>

    <script>
        // ...existing code...
        const form = document.getElementById('lead-form');
        const btn = document.getElementById('submit-btn');
        const msg = document.getElementById('msg');

        async function getAgentId() {
            return new URLSearchParams(window.location.search).get('agent_id') || 'direct';
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!document.getElementById('consent').checked) {
                alert('Please accept terms to proceed.');
                return;
            }

            btn.classList.add('busy');
            btn.textContent = 'Sending...';
            msg.style.display = 'none';

            const leadData = {
                name: document.getElementById('name').value.trim(),
                email: document.getElementById('email').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                level: document.getElementById('level').value,
                marketing_consent: document.getElementById('consent').checked,
                agent_id: await getAgentId(),
                referrer: document.referrer || null,
                user_agent: navigator.userAgent
            };

            try {
                const res = await fetch('/api/leads', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(leadData)
                });
                if (!res.ok) throw new Error('Network response was not ok');
                msg.textContent = 'Match request sent! We will contact you soon.';
                msg.style.display = 'block';
                form.reset();
            } catch (err) {
                console.error('Submit error:', err);
                alert('There was an error submitting your request. Please try again later.');
            } finally {
                btn.classList.remove('busy');
                btn.textContent = 'Find My Match';
            }
        });
        // ...existing code...
    </script>
</body>
</html>
